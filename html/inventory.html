<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Page - Inventory</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>
  <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
    </div>

    <!-- Main Content -->
    <div class="container text-center flex-grow-1" id="page-content-wrapper">
      <h1>Inventory</h1>

      <!-- Storage Section -->
      <section class="my-4">
        <h3>Storage</h3>
        <table class="table table-bordered">
          <thead>
              <tr>
                  <th>Container</th>
                  <th>Capacity</th>
                  <th>Resource</th>
                  <th>Amount</th>
                  <th>Quality</th> <!-- New Quality Column -->
                  <th>Status</th>
              </tr>
          </thead>
          <tbody id="storage-table-body">
            <!-- Storage resources will be dynamically generated here -->
          </tbody>
        </table>
      </section>

      <!-- Warehouse Inventory -->
      <section class="my-4">
        <h3>Warehouse</h3>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Resource</th>
              <th>Amount</th>
              <th>Quality</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="warehouse-table-body">
            <!-- Warehouse resources will be dynamically generated here -->
          </tbody>
        </table>
      </section>

      <!-- Fermentation Tanks Inventory -->
      <section class="my-4">
        <h3>Fermentation Tanks</h3>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Resource</th>
              <th>Amount</th>
              <th>Quality</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="fermentation-table-body">
            <!-- Fermentation Tanks resources will be dynamically generated here -->
          </tbody>
        </table>
      </section>

      <!-- Wine Cellar Inventory -->
      <section class="my-4">
        <h3>Wine Cellar</h3>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Resource</th>
              <th>Amount</th>
              <th>Quality</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="winecellar-table-body">
            <!-- Wine Cellar resources will be dynamically generated here -->
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <!-- Properly order JS dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="/js/loadPanel.js"></script>
  <script type="module" src="/js/database/loadSidebar.js"></script>

  <script type="module">
      import { inventoryInstance, displayInventory } from '/js/resource.js'; // Ensure proper import
      import { initializeSidebar } from '/js/database/loadSidebar.js';
      import { initializePanel } from '/js/loadPanel.js';
      import { initializeConsole } from '/js/console.js'; // Import the console initializer

      document.addEventListener('DOMContentLoaded', function () {
        initializePanel();
        initializeSidebar();
        initializeConsole();

        // Populate storage table
        populateStorageTable();

        // Show the inventory
        displayInventory(inventoryInstance);
      });

    function populateStorageTable() {
        const storageTableBody = document.getElementById('storage-table-body');

        // Retrieve buildings from local storage
        const buildings = JSON.parse(localStorage.getItem('buildings')) || []; // Adjusting the key to fetch buildings
        console.log('Retrieved buildings from local storage:', buildings);
        // Clear existing entries
        storageTableBody.innerHTML = '';
        // Loop through each building and its contents to find tools
        buildings.forEach(building => {
            building.contents.forEach(tool => {
                console.log(`Processing tool: ${tool.name}, Capacity: ${tool.capacity}`); // Log each tool's name and capacity
                if (tool.capacity > 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${tool.name}</td>
                        <td>${tool.capacity}</td>
                        <td></td> <!-- Resource -->
                        <td></td> <!-- Amount -->
                        <td>N/A</td> <!-- Quality Column -->
                        <td></td> <!-- Status Column -->
                    `;
                    storageTableBody.appendChild(row);
                    console.log(`Added row for tool: ${tool.name}`); // Log when a row is added
                } else {
                    console.log(`Skipped tool: ${tool.name} (Capacity <= 0)`); // Log if tool is skipped
                }
            });
        });
        // Log final state of the table body
        console.log('Final HTML of the Storage table:', storageTableBody.innerHTML);
    }
  </script>
</body>
</html>